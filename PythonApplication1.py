
import telebot
from telebot import types
from apscheduler.schedulers.background import BackgroundScheduler
from datetime import date, datetime, timedelta

TOKEN = "7197275852:AAHj6uZ64idQ3GA3q5FLStsw5o3Y6q_nIJA"
CHAT_ID = -4825230345

bot = telebot.TeleBot(TOKEN)
scheduler = BackgroundScheduler()

schedule = {
    0: {
        "odd": [
            {"time": "08:00", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞"},
            {"time": "09:50", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–∞–±. –ø—Ä–∞–∫—Ç–∏–∫—É–º", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞ / –û–∫—Å–∞–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞ –õ—É—á—à–µ–≤–∞"},
            {"time": "11:55", "subject": "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–Ü—Ä–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞ –¢–æ–º–∞–∑ / –û–ª–µ–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞ –ù–æ–≤–∏—Ü—å–∫–∞"},
            {"time": "13:45", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–∞–≤–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ê—Ä—Ç–µ–º –Ñ–≤–≥–µ–Ω–æ–≤–∏—á –ì–æ–ª—É–±–æ–≤"},
        ],
        "even": [
            {"time": "08:00", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞"},
            {"time": "09:50", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–∞–±. –ø—Ä–∞–∫—Ç–∏–∫—É–º", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞ / –û–∫—Å–∞–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞ –õ—É—á—à–µ–≤–∞"},
            {"time": "11:55", "subject": "–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ù—ñ–Ω–∞ –í–∞–ª–µ—Ä—ñ—ó–≤–Ω–∞ –°–∞–≤—á–µ–Ω–∫–æ"},
            {"time": "13:45", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–∞–≤–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ê—Ä—Ç–µ–º –Ñ–≤–≥–µ–Ω–æ–≤–∏—á –ì–æ–ª—É–±–æ–≤"},
        ]
    },
    1: {
        "odd": [
            {"time": "09:50", "subject": "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ê–Ω–¥—Ä—ñ–π –ì—Ä–∏–≥–æ—Ä–æ–≤–∏—á –ß—É—Ö—Ä–∞–π"},
            {"time": "11:55", "subject": "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ –∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º, –ª–µ–∫—Ü—ñ—è", "teacher": "–û–ª–µ–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞ –ö–æ–Ω–æ–≤—á–µ–Ω–∫–æ"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–∞–≤–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–ê—Ä—Ç–µ–º –Ñ–≤–≥–µ–Ω–æ–≤–∏—á –ì–æ–ª—É–±–æ–≤"},
            {"time": "13:45", "subject": "–§—ñ–∑–∏—á–Ω–µ –≤–∏—Ö–æ–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–î–∏–≤—ñ—Ç—å—Å—è –≤ –º–µ–Ω—Ç–æ—Ä—ñ"},
        ],
        "even": [
            {"time": "09:50", "subject": "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ê–Ω–¥—Ä—ñ–π –ì—Ä–∏–≥–æ—Ä–æ–≤–∏—á –ß—É—Ö—Ä–∞–π"},
            {"time": "11:55", "subject": "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ –∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º, –ª–µ–∫—Ü—ñ—è", "teacher": "–û–ª–µ–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞ –ö–æ–Ω–æ–≤—á–µ–Ω–∫–æ"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–∞–≤–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–ê—Ä—Ç–µ–º –Ñ–≤–≥–µ–Ω–æ–≤–∏—á –ì–æ–ª—É–±–æ–≤"},
            {"time": "13:45", "subject": "–§—ñ–∑–∏—á–Ω–µ –≤–∏—Ö–æ–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–î–∏–≤—ñ—Ç—å—Å—è –≤ –º–µ–Ω—Ç–æ—Ä—ñ"},
        ]
    },
    2: {
        "odd": [
            {"time": "08:00", "subject": "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–Ü—Ä–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞ –¢–æ–º–∞–∑ / –û–ª–µ–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞ –ù–æ–≤–∏—Ü—å–∫–∞"},
            {"time": "09:50", "subject": "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–¢–µ—Ç—è–Ω–∞ –ì—Ä–∏–≥–æ—Ä—ñ–≤–Ω–∞ –î–µ–≥—Ç—è—Ä—å–æ–≤–∞"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞"},
            {"time": "11:55", "subject": "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ –∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–Ü–Ω–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞ –í—è–ª–∏—Ö"},
        ],
        "even": [
            {"time": "08:00", "subject": "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–Ü—Ä–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞ –¢–æ–º–∞–∑ / –û–ª–µ–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞ –ù–æ–≤–∏—Ü—å–∫–∞"},
            {"time": "09:50", "subject": "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–¢–µ—Ç—è–Ω–∞ –ì—Ä–∏–≥–æ—Ä—ñ–≤–Ω–∞ –î–µ–≥—Ç—è—Ä—å–æ–≤–∞"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ñ–≤–≥–µ–Ω—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞"},
            {"time": "11:55", "subject": "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ –∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–Ü–Ω–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞ –í—è–ª–∏—Ö"},
        ]
    },
    3: {
        "odd": [
            {"time": "08:00", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–û–∫—Å–∞–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞ –õ—É—á—à–µ–≤–∞"},
            {"time": "09:50", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ü–≥–æ—Ä –ë–æ—Ä–∏—Å–æ–≤–∏—á –¢—É—Ä–∫—ñ–Ω"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–õ—é–¥–º–∏–ª–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞ –ú–∞–Ω–¥—Ä—ñ–∫–æ–≤–∞"},
            {"time": "13:45", "subject": "–§—ñ–∑–∏—á–Ω–µ –≤–∏—Ö–æ–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–î–∏–≤—ñ—Ç—å—Å—è –≤ –º–µ–Ω—Ç–æ—Ä—ñ"},
        ],
        "even": [{"time": "08:00", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–û–∫—Å–∞–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞ –õ—É—á—à–µ–≤–∞"},
            {"time": "09:50", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó, –ª–µ–∫—Ü—ñ—è", "teacher": "–Ü–≥–æ—Ä –ë–æ—Ä–∏—Å–æ–≤–∏—á –¢—É—Ä–∫—ñ–Ω"},
            {"time": "11:55", "subject": "–û—Å–Ω–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–õ—é–¥–º–∏–ª–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞ –ú–∞–Ω–¥—Ä—ñ–∫–æ–≤–∞"},
            {"time": "13:45", "subject": "–§—ñ–∑–∏—á–Ω–µ –≤–∏—Ö–æ–≤–∞–Ω–Ω—è, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–î–∏–≤—ñ—Ç—å—Å—è –≤ –º–µ–Ω—Ç–æ—Ä—ñ"},
        ]
    },
    5: {
        "odd": [
            {"time": "08:00", "subject": "–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ù—ñ–Ω–∞ –í–∞–ª–µ—Ä—ñ—ó–≤–Ω–∞ –°–∞–≤—á–µ–Ω–∫–æ"},
            {"time": "09:50", "subject": "–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–ù–∞—Ç–∞–ª—ñ—è –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞ –î—Ä–∞—à–ø—É–ª—å"},
        ],
        "even": [
            {"time": "08:00", "subject": "–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ª–µ–∫—Ü—ñ—è", "teacher": "–ù—ñ–Ω–∞ –í–∞–ª–µ—Ä—ñ—ó–≤–Ω–∞ –°–∞–≤—á–µ–Ω–∫–æ"},
            {"time": "09:50", "subject": "–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –ø—Ä–∞–∫—Ç–∏–∫–∞", "teacher": "–ù–∞—Ç–∞–ª—ñ—è –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞ –î—Ä–∞—à–ø—É–ª—å"},
        ]
    }
}

def get_week_type():
    week_num = date.today().isocalendar()[1]
    return "odd" if week_num % 2 == 0 else "even"

keyboard = types.InlineKeyboardMarkup(row_width=1)
btn = types.InlineKeyboardButton("Mentor", url="https://mentor.khai.edu/")
keyboard.add(btn)

def send_message(subject, teacher, time):
    msg = f"üìö <em>{time}</em> <b>{subject}</b>\n"
    if teacher:
        msg += f"üë©‚Äçüè´ –í–∏–∫–ª–∞–¥–∞—á: <b>{teacher}</b>\n"
    msg += "\n‚è∞ –ü–∞—Ä–∞ –ø–æ—á–Ω–µ—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 —Ö–≤–∏–ª–∏–Ω !"

    bot.send_message(CHAT_ID, msg, parse_mode="HTML", reply_markup=keyboard)


def schedule_lessons():
    scheduler.remove_all_jobs()  # –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏
    week_type = get_week_type()
    today = date.today().weekday()

    for day, lessons in schedule.items():
        for lesson in lessons.get(week_type, []):
            hour, minute = map(int, lesson["time"].split(":"))
            lesson_time = datetime(year=1, month=1, day=1, hour=hour, minute=minute)  # –¥–∞—Ç–∞ —Ñ–∏–∫—Ç–∏–≤–Ω–∞—è
            notify_time = lesson_time - timedelta(minutes=5)
            scheduler.add_job(
                send_message,
                "cron",
                day_of_week=day,
                hour=notify_time.hour,
                minute=notify_time.minute,
                args=[lesson["subject"], lesson["teacher"], lesson["time"]]
            )

schedule_lessons()
scheduler.start()

@bot.message_handler(commands=["start"])
def start(message):
    bot.reply_to(message, f"‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –í–∞—à chat_id: {message.chat.id}")



bot.polling(non_stop=True)